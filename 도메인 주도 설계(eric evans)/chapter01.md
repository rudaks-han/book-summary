# 제1부 동작하는 도메인 모델 만들기

![image-20210218200646548](chapter01.assets/image-20210218200646548.png)



18세기 중국 지도. 중국의 사회상에 맞게 세계를 모델화한 것이고 중국에 초점을 맞췄다. 다른 나라를 이해하는 데는 도움이 되지 못하고 오늘날 중국의 모습과도 전혀 맞지 않다.

지도는 모델이며, 모든 모델은 중요한 사실이나 사상의 일부 측면을 나타낸다. `모델은 대상을 단순화한 것`이다. 즉, 모델은 어떤 사실을 해석한 것으로 볼 수 있고, 당면한 문제를 해결하는 것과 관련된 측면을 추상화하고 <u>그 밖에 중요하지 않은 세부사항에는 주의를 기울이지 않는다</u>.

사용자의 활동에 도움이 되는 소프트웨어를 만들기 위해서 개발팀은 사용자의 활동과 관련된 지식체계에 집중해야 한다. 모델은 이러한 부담을 해소하기 위한 도구다. 모델은 지식을 선택적으로 단순화하고 의식적으로 구조화한 형태다.

도메인 모델링은 가능한 한 "사실적인" 모델을 만드는 문제가 아니다. 현실 세계에 실재하는 사물에 대한 도메인에서도 모델은 인위적 창조물이다. 그리고 단순한 결과를 내는 소프트웨어 매커니즘을 만드는 것도 아니다. 도메인 모델링은 어떤 목적에 따라 제약에 구애받지 않고 `현실을 표현하는 영화 제작`에 가깝다. 다큐멘터리 영화에서도 실생활을 편집해서 보여준다.



## 도메인 주도 설계에서의 모델의 유용성

1. **모델과 핵심 설계는 서로 영향을 주며 구체화된다. ** 모델이 프로그램에 적용되게끔 하는 것은 모델과 구현 간의 긴밀한 연결이다. 이러한 모델과 구현의 연결은 유지보수와 계속되는 기능 개선에도 도움이 되는데 그 이유는 <u>모델을 이해한 바에 근거해 코드를 해석</u>할 수 있기 때문이다.
2. **모델은 모든 팀 구성원이 사용하는 언어의 중추다**. 모델과 구현에서 사용하는 용어가 동일해야 한다.
3. **모델은 지식의 정수만을 뽑아낸 것이다.**  



## 소프트웨어의 본질

소프트웨어의 본질 = 도메인에 관련된 문제를 해결하는 능력

개발자는 이러한 문제를 해결하기 위해서 도메인 연구에 몰두해야 한다. 그뿐만 아니라 모델링 기법을 연마해서 도메인 설계에 통달해야 한다.

그러나 이러한 도메인 연구는 최우선 과제로 여겨지지 않는다.

**대부분 유능한 개발자** = 도메인을 학습하는 데 관심 없음. 도메인 모델링 기법을 쌓는데 전념하지 않음

**기술자들** = 자신의 기술력을 훈련할 수 있는 정략적인 문제를 좋아함. 도메인 업무는 무질서하고 개발자로서의 능력에 보탬이 될것 같지 않음

**기술적 재능이 있는 사람** = 정교한 프레임워크를 만드는 작업에 착수해 기술을 바탕으로 도메인 문제를 해결하려 함.



# 01 지식 탐구

## 효과적인 모델링의 요소

1. `모델과 구현의 연계`
2. 모델을 기반으로 하는 `언어 정제`
3. `풍부한 지식`이 담긴 모델 개발: 모델은 단순히 데이터 스키마가 아니라 복잡한 문제를 해결하는 데 필수불가결한 것이었다. 모델에는 다양한 지식이 포함돼 있었다.
4. `모델의 정제`. 모델에는 중요한 개념이 더해졌으며 쓸모없거나 중요하지 않다고 판명된 개념이 제거됐다는 점이 중요하다. 불필요한 개념과 필요한 개념이 한데 묶여 있을 경우 본질과 무관한 개념은 모두 제거할 수 있게 본질적인 개념만을 식별할 수 있는 새로운 모델을 고안해냈다.
5. 브레인스토밍과 실험. 스케치. 시나리오를 말로 표현해보기만 해도 타당성 여부를 재빨리 판단할 수 있다.



## 지식 탐구

재무 분석가는 숫자를 면밀하게 검토한다.

**도메인 모델링을 수행하는 사람들**

- 지식을 면밀하게 탐구한다.
- 엄청나게 많은 정보 속에서 미미한 관련성을 찾아낸다.
- 전체를 이해할 수 있는 간결한 관점을 찾아 체계적인 아이디어를 시도해본다.
- 수많은 모델이 시도,거부,변형된다.
- 세부사항에 맞는 추상적 개념이 나타나면 비로소 성공에 이른다.



**지식탐구 활동**

- 혼자서 하는 활동이 아니다.
- 개발자와 도메인 전문가로 구성된 팀이 협업
- 지식은 도메인 전문가의 머리속, 기존 시스템 사용자, 동일한 도메인에 관련된 레거시 시스템의 기술팀, 다른 프로젝트 경험에서 나온다.
- 지식은 문서의 형태를 띄며, 대화의 형태도 많다.



**폭포수 개발 방식**

- 업무 전문가가 분석가에서 설명하고 다시 분석가는 업무 전문가가 설명한 내용을 이해하고 추상화해서 소프트웨어를 코드로 작성하는 프로그래머에게 넘긴다. 
- 이런 접근법은 피드백이 전혀 없어서 실패하기 마련이다.
- 모델을 만드는 모든 책임은 분석가에게만 있다. 업무 전문가가 알려주는 사항에만 근거한다.
- 분석가들은 프로그래머에게서 배우는 기회를 얻지 못한다.
- 지식은 한 방향으로만 흘러갈 뿐 축적되지 않는다.



**지식 축적 실패**

- 개발자들은 원하는 기능을 전문가가 기술하게 하고 기능 구현을 시작
- 결과를 전문가에게 보여주고 다음 해야할 일을 정한다.
- 개발자가 도메인에 관심없다면 숨겨진 원리는 알지 못한채 애플리케이션에서 수행하는 일만 습득한다.



**훌륭한 프로그래머**

- 애초부터 추상화를 시작해서 좋은 모델로 발전시킬 것이다.
- 이런 과정이 도메인 전문가의 협업 없이 기술적인 측면에서 일어난다면 개념은 초보적인 수준에 머문다.



**팀 모델링**

- 지속적인 정체를 하는 개발자는 기능에만 머무르지 않고 업무의 중요 원칙들을 배운다.
- 모델은 명료하게 조직화, 추상화될 수 있으며 구현을 더 용이하게 만들어준다.
- 도메인 전문가의 지속적인 관여로 심층적인 업무 지식을 반영하고, 추상화된 개념은 업무 원칙에 해당한다.



## 지속적인 학습

소프트웨어 개발을 시작할 때 우리는 충분히 알지 못한 상태에서 시작한다. 지식은 단편적이고, 문서는 흩어져있고, 정말 필요한 지식이 어떤 것인지 알지 못한다. 기술적으로 어려워 보이지 않는데 힘든 경우가 있다. 우리는 스스로 얼마나 알지 못하는 가를 깨닫지 못한다.

**지식의 이동**

- 모든 프로젝트에서는 지식이 새기 마련
- 학습한 사람들은 계속 자리를 옮긴다.
- 조직 개편으로 팀이 흩어지고 지식도 다시 흩어진다.
- 중대한 하위 시스템은 외주 제작되어 코드는 전달되지만 지식은 전달되지 않는다.



지속적인 학습

- 생산성이 매우 뛰어난 팀은 지속적인 학습이 있어야 한다.
- 개발자에게 도메인 모델링 기술과 기술적 지식이 모두 향상된다는 것을 의미한다.
- 특정 도메인에 관해 진지하게 학습하는 것도 포함된다.



## 풍부한 지식이 담긴 설계

모델의 지식은 단순한 "명사 찾기" 이상이다. 엔티티만큼 업무 활동과 규칙도 도메인에 중요한데, 어떠한 도메인에도 다양한 범주의 개념이 존재한다. 지식탐구는 이러한 통찰력을 반영하는 모델을 만들어낸다.



예제) 감춰진 개념 추출하기

> 10% 초과예약 허용

```java
public int makeBooking(Cargo cargo, Voyage voyage) {
  double maxBooking = voyage.capacity() * 1.1;
  if ((voyage.bookedCargoSize() + cargo.size()) > maxBooking)
    return -1;
  ...
}
```

1. 코드가 작성된 대로라면 개발자의 도움이 있더라도 업무 전문가가 이 코드를 읽고 규칙을 검증하지는 못할 것이다.
2. 해당 업무에 종사하지 않고 기술적인 측면만 담당하는 사람은 코드와 요구사항을 결부시키기가 어려울 것이다.



초과예약 규칙 == 정책(policy)

새 Overbookng Policy(초과예약 정책) 클래스에는 아래 메서드가 포함된다.

```java
public boolean isAllowed(Cargo cargo, Voyage voyage) {
  return (cargo.size() + voyage.bookedCargoSize()) <= (voyage.capacity() * 1.1);
}
```



더 명시적인 설계는 아래와 같은 이점이 있다.

1. 초과예약의 특성을 단순한 계산에 불과한 것이 아니라 별개의 중요한 업무 규칙임을 알아야만 할 것이다.
2. 프로그래머는 업무 전문가에게 이해할 수 있는 수준에서 코드까지 보여줄 수 있고 피드백을 받을 수 있다.



## 심층 모델

지식 탐구는 탐험과도 같아서 어디서 끝나게 될지 알지 못한다.



