# 제2부 모델 주도 설계의 기본 요소

소프트웨어 구현을 건전한 상태로 유지하고 모델과의 밀접한 관계를 유지하려면  모델링과 설계의 우수 실천법을 적용해야 한다.

![image-20210220104236265](chapter04.assets/image-20210220104236265.png)





# 04 도메인의 격리



### LAYERED ARCHITECTURE (계층형 아키텍처)

![img](chapter04.assets/dddlayered.png) 



**화물의 목적지를 선택하는 해운 애플리케이션**

1. 위젯을 화면이 그리고
2. 선택 가능한 모든 도시 목록을 데이터베이스에서 조회하며
3. 사용자가 입력한 내용을 해석하고 유효성을 검증하고
4. 선택된 도시를 화물과 연결하며
5. 변경내역을 데이터베이스에 반영한다.

이 중 일부만이 해운 업무와 관련돼 있다.



**프로그램을 작성하는 가장 빠른 방법**

* 객체지향 프로그램에서는 종종 사용자 인터페이스와 데이터베이스, 기타 보조적인 코드를 비즈니스 객체 안에 직접 작성하기도 하다. 
* 부가적인 업무 로직은 UI위젯과 데이터베이스 스크립트에 들어간다. 
* 이런 일이 발생하는 까닭은 단기적으로는 이렇게 하는 것이 뭔가를 동작하게 하는 가장 쉬운 방법이기 때문이다.



**도메인 코드 + 세부적인(기술, DB, UI) 코드**

* 도메인에 관련된 코드가 상당한 양의 도메인과 관련이 없는 다른 코드와 혼재되어 존재하는 경우 도메인에 관련된 코드를 확인하고 추론하기가 굉장히 힘들어진다. 
* UI를 변경하는 것이 실질적으로 업무 로직을 변경하는 것으로 이어질 수 있다. 
* 업무 규칙을 변경하고자 UI코드나 데이터베이스 코드를 추적해야 할지도 모른다. 
* 응집력 있고, 모델 주도적인 객체를 구현하는 것이 비현실적인 이야기가 돼버리고 자동화 테스트가 어려워진다. 



**관심사 분리**

* 매우 복잡한 작업을 처리하는 소프트웨어를 만들 경우 `관심사 분리(separation of concern)`가 필요하며, 이로써 격리된 상태에 있는 각 설계 요소에 집중할 수 있다. 
* 동시에 시스템 내의 정교한 상호작용은 그러한 분리와는 상관없이 유지돼야 한다.



**Layered Architecture (계층형 아키텍처)**

* 한 계층의 모든 요소는 오직 같은 계층에 존재하는 다른 요소나 계층상 "아래"에 위치한 요소에만 의존한다는 것이다.
* 위로 올라가는 의사소통은 반드시 간접적인 메커니즘을 거쳐야 한다.
* 계층화의 가치는 특정 측면만을 전문적으로 다룬다는 데 있다.



**Layered Architecture의 4가지 단계**

* 사용자 인터페이스 (표현 계층)
    * 사용자에게 정보를 보여주고 사용자 명령을 해석하는 일
* 응용 계층
    * 업무 규칙이나 지식이 포함되지 않으며, 오직 작업을 아래 위치한 계층인 도메인 객체의 협력자에게 작업을 위임한다.
* 도메인 계층 (모델 계층)
    * 업무 개념과 업무 상황에 대한 정보
* 인프라스트럭처 계층
    * 기술적 기능을 제공한다.
    * 메시지 전송, 도메인 영속화, UI에 위젯을 그리는 것



> 중요한 것은 도메인 계층을 다른 계층과 분리하는 것에 있다.
>
> * 복잡한 프로그램을 여러 개의 계층으로 나눠라.
> * 응집력 있고 오직 아래에 위치한 계층에만 의존하도록 해라.
> * 상위 계층과의 결합을 느슨하게 유지하라.
> * 도메인 모델과 관련된 코드는 모두 한 계층에 모으고 사용자 인터페이스 코드나 애플리케이션 코드, 인프라스트럭처 코드와 격리하라.
> * 도메인 객체는 도메인 모델을 표현하는 것에만 집중할 수 있다.
> * 모델은 진화를 거듭해 본질적인 업무 지식을 포착해서 해당 업무 지식이 효과를 발휘할 수 있을 만큼 풍부하고 명확해질 것이다.



예제: 온라인 뱅킹



### 계층 간 관계 설정

* 각 계층은 오직 한 방향으로만 둬서 느슨하게 결합된다.
* 상위 계층은 하위 계층의 공개 인터페이스를 호출한다.
* 하위 수준의 객체가 상위객체와 소통해야 할 경우 콜백이나 관찰자 패턴같은 아키텍처 패턴을 활용할 수 있다.



### 아키텍처 프레임워크



### 도메인 계층은 모델이 살아가는 곳



## SMART UI(지능형 UI) "안티 패턴"

SMART UI는 도메인 주도 설계 접근법과는 서로 양립할 수 없는 상호 배타적인 길에 놓인 접근법이다.



**SMART UI의 장점**

* 애플리케이션이 단순한 경우 생산성이 높고 효과가 즉각적으로 나타난다.
* 다소 능력이 부족한 개발자도 약간의 교육으로 업무를 진행할 수 있다.
* 요구사항 분석 단계에서 결함이 발생하더라도 요구에 맞게 제품을 변경해서 문제를 해결할 수 있다.
* 애플리케이션이 분리되므로 납기 일정을 계획할 수 있고 간단한 작업으로 시스템 확장하가기 수월하다.
* 관계형 데이터베이스와 잘 어울리고 데이터 수준의 통합이 가능하다.
* 4세대 언어 도구와 잘 어울린다.
* 유지보수 시 신속하게 작업을 진행할 수 있다. UI에 국한되기 때문이다.



**SMART UI의 단점**

* 데이터베이스를 이요하는 방식 말고는 여러 애플리케이션을 통합하기가 수월하지 않다.
* 행위를 재사용하지 않으며 업무 문제에 대한 추상화가 이뤄지지 않는다. 업무 규칙이 적용되는 연산마다 업무 규칙이 중복된다.
* 복잡성이 금방 압도되어 애플리케이션의 성장 경로가 단순 응용으로만 향한다.



